# üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –µ–¥–∏–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **PHP:** 7.4 –∏–ª–∏ –≤—ã—à–µ
- **MySQL:** 5.7 –∏–ª–∏ –≤—ã—à–µ  
- **–í–µ–±-—Å–µ—Ä–≤–µ—Ä:** Apache/Nginx
- **–†–∞—Å—à–∏—Ä–µ–Ω–∏—è PHP:** PDO, PDO_MySQL, session, json

## ‚ö° –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç –≤ MySQL (—Å–æ–∑–¥–∞—Å—Ç –ë–î auth)
mysql -u root -p < auth_database_schema.sql
```

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ë–î:**
- `auth` - –Ω–æ–≤–∞—è –ë–î –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `plan` - —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ë–î –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:
```bash
cp auth_config_template.php auth/includes/config.php
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `auth/includes/config.php`:
```php
// –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
define('AUTH_DB_CONFIG', [
    'host' => '127.0.0.1',
    'database' => 'auth', // –ù–æ–≤–∞—è –ë–î
    'username' => 'root',
    'password' => 'your_password'
]);

// –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –ë–î (–¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏)
define('PLAN_DB_CONFIG', [
    'host' => '127.0.0.1',
    'database' => 'plan', // –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ë–î
    'username' => 'root',
    'password' => 'your_password'
]);

// –û—Ç–∫–ª—é—á–∏—Ç–µ debug —Ä–µ–∂–∏–º –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
define('DEV_CONFIG', [
    'debug_mode' => false,
    'show_sql_errors' => false,
    'bypass_sms_verification' => false
]);
```

### 3. –ú–∏–≥—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ü–µ—Ä–µ–Ω–µ—Å–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –ë–î `plan` –≤ –ë–î `auth`:

```bash
# –ò–∑ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
php auth/migration/migrate_users.php

# –ò–ª–∏ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä (–¥–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á)
http://your-domain/auth/migration/migrate_users.php?admin_key=your_secret
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—è:**
- –ü–µ—Ä–µ–Ω–æ—Å–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ `plan.users` –≤ `auth.auth_users`
- –•–µ—à–∏—Ä—É–µ—Ç –ø–∞—Ä–æ–ª–∏ —Å –ø–æ–º–æ—â—å—é bcrypt
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ü–µ—Ö–∞–º

**–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**
- –û–±–Ω–æ–≤–∏—Ç–µ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ü–µ—Ö–∞–º
- –û–±–Ω–æ–≤–∏—Ç–µ –§–ò–û –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

```bash
# –ü—Ä–∞–≤–∞ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
chmod 755 auth/
chmod 755 auth/logs/
chmod 755 auth/uploads/
chmod 644 auth/includes/*.php
```

### 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `http://your-domain/auth/`
2. –í–æ–π–¥–∏—Ç–µ —Å –¥–∞–Ω–Ω—ã–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:
   - **–¢–µ–ª–µ—Ñ–æ–Ω:** +380995527932
   - **–ü–∞—Ä–æ–ª—å:** 7932

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

### –î–ª—è –∫–∞–∂–¥–æ–π —Å–∏—Å—Ç–µ–º—ã (plan/, plan_U3/, plan_U4/, plan_U5/):

1. **–î–æ–±–∞–≤—å—Ç–µ –≤ –Ω–∞—á–∞–ª–æ –∫–∞–∂–¥–æ–≥–æ PHP —Ñ–∞–π–ª–∞:**
```php
<?php
// –í —Å–∞–º–æ–µ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞, –¥–æ –ª—é–±–æ–≥–æ –¥—Ä—É–≥–æ–≥–æ –∫–æ–¥–∞
require_once '../auth/includes/integration.php';

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ü–µ—Ö–∞
$user = checkAuthIntegration('U2'); // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω—É–∂–Ω—ã–π —Ü–µ—Ö
if (!$user) {
    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—É–¥–µ—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
    exit;
}

// –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å $user['full_name'], $user['phone'] –∏ —Ç.–¥.
?>
```

2. **–ó–∞–º–µ–Ω–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:**

**–ë—ã–ª–æ:**
```php
if (!isset($_SESSION['user']) || !isset($_SESSION['workshop'])) {
    header('Location: index.php');
    exit;
}
$user = $_SESSION['user'];
$workshop = $_SESSION['workshop'];
```

**–°—Ç–∞–ª–æ:**
```php
$authUser = checkAuthIntegration('U2'); // –ö–æ–¥ —Ü–µ—Ö–∞
$user = $authUser['full_name'];
$workshop = $_SESSION['auth_department'];
```

3. **–û–±–Ω–æ–≤–∏—Ç–µ –Ω–∞–≤–∏–≥–∞—Ü–∏—é:**
```php
// –î–æ–±–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É
echo '<a href="/auth/select-department.php">–°–º–µ–Ω–∏—Ç—å —Ü–µ—Ö</a>';
echo '<a href="/auth/logout.php">–í—ã–π—Ç–∏</a>';
```

## üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```sql
-- 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
INSERT INTO auth_users (phone, password_hash, full_name, is_active, is_verified) 
VALUES ('+79001234567', '$2y$12$hash...', '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤', 1, 1);

-- 2. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ü–µ—Ö–∞–º
INSERT INTO auth_user_departments (user_id, department_code, role_id) 
VALUES (LAST_INSERT_ID(), 'U2', 2); -- 2 = manager
```

### –†–æ–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–µ

| ID | –†–æ–ª—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|----|------|----------|
| 1 | worker | –†–∞–±–æ—á–∏–π - –±–∞–∑–æ–≤—ã–µ –ø—Ä–∞–≤–∞ |
| 2 | manager | –ú–µ–Ω–µ–¥–∂–µ—Ä - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏ |
| 3 | supervisor | –ú–∞—Å—Ç–µ—Ä - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∞ |
| 4 | director | –î–∏—Ä–µ–∫—Ç–æ—Ä - –ø–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∞ |

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
http://your-domain/auth/api/check-auth.php
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
# –õ–æ–≥–∏ –æ—à–∏–±–æ–∫ –ë–î
tail -f auth/logs/database_errors.log

# –õ–æ–≥–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
tail -f /var/log/apache2/error.log
```

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **"–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î"**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `config.php`
   - –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ MySQL –∑–∞–ø—É—â–µ–Ω
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë–î

2. **"–¢–∞–±–ª–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"**
   - –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç: `auth_database_schema.sql`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ë–î

3. **"–°–µ—Å—Å–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å–µ—Å—Å–∏–π
   - –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `session_start()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

1. **–û—Ç–∫–ª—é—á–∏—Ç–µ debug —Ä–µ–∂–∏–º:**
```php
define('DEV_CONFIG', [
    'debug_mode' => false,
    'show_sql_errors' => false
]);
```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ HTTPS:**
```php
define('AUTH_SECURITY', [
    'session_cookie_secure' => true, // –¢–æ–ª—å–∫–æ –¥–ª—è HTTPS
]);
```

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª:**
```bash
# –ó–∞–∫—Ä–æ–π—Ç–µ –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–∞–º
# –î–æ–±–∞–≤—å—Ç–µ –≤ .htaccess:
<Files "*.php">
    Order Deny,Allow
    Deny from all
    Allow from 127.0.0.1
</Files>
```

4. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –ø–∞—Ä–æ–ª–∏:**
```sql
-- –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª–µ–π —Å—Ç–∞—Ä—à–µ 90 –¥–Ω–µ–π
UPDATE auth_users 
SET password_hash = NULL 
WHERE updated_at < DATE_SUB(NOW(), INTERVAL 90 DAY);
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
3. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–∏—Å—Ç–µ–º—ã

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 2 –æ–∫—Ç—è–±—Ä—è 2025
