# Сравнение ввода выпущенных гофропакетов У5 и У2

Документ описывает, как вносятся и куда попадают выпущенные гофропакеты в программе для участков У5 (plan_U5) и У2 (plan).

**С текущей версией У2 и У5 используют одну и ту же процедуру:** факт хранится в таблице `manufactured_corrugated_packages`, ввод через форму «добавить позицию» (фильтр + заявка + количество), с возможностью удалить последнюю внесённую запись.

---

## Итоговая схема (актуально для У2 и У5)

- **У2** — факт в таблице `manufactured_corrugated_packages` (БД `plan`), ввод через форму «Изготовленные гофропакеты» на странице «Задания гофромашины».
- **У5** — факт в таблице `manufactured_corrugated_packages` (БД `plan_U5`), та же форма и сценарий ввода.

---

## 1. Где хранятся данные

| Аспект                | У2 (plan)                                                                                | У5 (plan_U5)                                                                                                                 |
| --------------------- | ---------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------- |
| **БД**                | `plan`                                                                                   | `plan_U5`                                                                                                                    |
| **План гофропакетов** | Таблица `corrugation_plan` (order_number, plan_date, filter_label, count)                | Та же структура: `corrugation_plan`                                                                                          |
| **Факт (выпуск)**     | Таблица `manufactured_corrugated_packages`: date_of_production, order_number, filter_label, count, timestamp | Та же структура в БД `plan_U5` |

В аналитике (`analytics/index.php`) для У2 и У5 используется таблица `manufactured_corrugated_packages` (поле `count`).

---

## 2. Как вносятся выпущенные гофропакеты

### У2 (plan)

- **Экран ввода:** `plan/worker_modules/tasks_corrugation.php` — «Задания гофромашины».
- **Данные на экран:** план — из `corrugation_plan` по дате (с группировкой по заявке/фильтру); факт за день — из `manufactured_corrugated_packages` по `date_of_production`.
- **Действие пользователя:** форма «Добавить»: выбор/ввод фильтра, выбор заявки, количество, кнопка «Внести». Кнопка «Удалить последнюю» для последней внесённой позиции (`plan/worker_modules/delete_last_manufactured_package.php`).
- **Сохранение:** форма отправляется в `plan/worker_modules/save_manufactured_corrugated_packages.php`: `INSERT INTO manufactured_corrugated_packages (date_of_production, order_number, filter_label, count) VALUES (?, ?, ?, ?)`.
- **Попадание в программу:** заявки, буфер, аналитика и отчёты читают факт из `manufactured_corrugated_packages` (см. ниже).

### У5 (plan_U5)

- **Экран ввода:** `plan_U5/worker_modules/tasks_corrugation.php` — тот же заголовок «Задания гофромашины».
- **Данные на экран:** план — из `corrugation_plan` по дате (с группировкой по заявке/фильтру); факт за день — отдельным запросом из `manufactured_corrugated_packages` по `date_of_production`.
- **Действие пользователя:** внизу страницы форма «Добавить»: выбор/ввод фильтра, выбор заявки, количество, кнопка «Внести». Для последней внесённой позиции доступна кнопка «Удалить последнюю» (вызов `plan_U5/worker_modules/delete_last_manufactured_package.php`).
- **Сохранение:** отправка формы в `plan_U5/worker_modules/save_manufactured_corrugated_packages.php`: `INSERT INTO manufactured_corrugated_packages (date_of_production, order_number, filter_label, count) VALUES (?, ?, ?, ?)`. То есть каждое внесение — **новая строка** в таблице факта, план не меняется.
- **Попадание в программу:** все отчёты и заявки по У5 берут факт из `manufactured_corrugated_packages` (суммы по заявке/фильтру/дате), а не из `corrugation_plan`.

---

## 3. Точки входа в программу

- **У2:** с главной `index.php` кнопка «Гофрирование U2» открывает `/plan/worker_modules/tasks_corrugation.php`; в `plan/main.php` — форма «Модуль оператора ГМ» с тем же `worker_modules/tasks_corrugation.php`.
- **У5:** «Гофрирование U5» → `/plan_U5/worker_modules/tasks_corrugation.php`; в `plan_U5/main.php` — «Модуль оператора ГМ» → `worker_modules/tasks_corrugation.php`.

В программу и У2, и У5 вносят выпущенные гофропакеты через один и тот же по смыслу экран («Задания гофромашины»), но скрипты и таблицы разные.

---

## 4. Где используются внесённые данные

- **Заявка (карточка заявки):** У2 и У5 — колонка «Изготовленные гофропакеты, шт» считается по `manufactured_corrugated_packages` (функция `get_corr_fact_for_filter` в `plan/show_order.php` и `plan_U5/show_order.php`).
- **Буфер гофропакетов:** У2 и У5 — «что сгофрировано» из `manufactured_corrugated_packages` (SUM(count)), «что забрано в сборку» из таблицы сборки участка.
- **Аналитика:** `analytics/index.php` — для вчерашнего дня У2 и У5 используют SUM(count) по `manufactured_corrugated_packages` в своей БД.

---

## 5. Сводная таблица

| Критерий                  | У2                                                      | У5                                                           |
| ------------------------- | ------------------------------------------------------- | ------------------------------------------------------------ |
| Хранение факта            | Таблица `manufactured_corrugated_packages` (БД plan)    | Таблица `manufactured_corrugated_packages` (БД plan_U5)        |
| Модель ввода              | Форма «добавить позицию» (фильтр, заявка, количество)    | Та же форма                                                     |
| Удаление последнего ввода | Есть (delete_last_manufactured_package)                 | Есть (delete_last_manufactured_package)                        |

---

Таким образом, выпущенные гофропакеты на **У2** и **У5** вносятся одинаково: в таблицу `manufactured_corrugated_packages` через страницу «Задания гофромашины» и форму «Внести» (скрипт `save_manufactured_corrugated_packages.php`), с возможностью удалить последнюю запись через `delete_last_manufactured_package.php`.
