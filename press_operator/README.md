# Модуль оператора тигельного пресса

## Описание
Модуль для учета работы тигельного пресса на производстве. Позволяет отслеживать высеченные заготовки и склеенные коробки за смену.

**Важно:** Модуль использует отдельную базу данных `press_module`, которая создается автоматически при первом запуске. Данные не привязаны к конкретным участкам (U2/U3/U4/U5).

## Функциональность

### 1. Учет высеченных заготовок
- Внесение количества высеченных заготовок за смену
- Указание типа коробки
- Автоматическое сохранение имени оператора
- Возможность добавления примечаний

### 2. Учет склеенных коробок
- Внесение количества склеенных коробок за смену
- Указание типа коробки
- Автоматическое сохранение имени оператора
- Возможность добавления примечаний

### 3. Статистика
- Общее количество высеченных заготовок за смену
- Общее количество склеенных коробок за смену
- История внесения данных с временными метками

### 4. Управление
- Выбор даты смены
- Автоматическое обновление статистики
- Кнопка управления справочником (для admin/director)

## Доступ

Модуль доступен пользователям с ролями:
- `admin` - Администратор системы
- `director` - Директор  
- `box_operator` - Оператор тигельного пресса

## Установка

### 1. Добавление роли
Выполните SQL скрипт для добавления роли:
```bash
mysql -u root -p < add_press_operator_role.sql
```

Или выполните через phpMyAdmin/HeidiSQL на базе данных `auth`.

### 2. Назначение роли
Назначьте роль `box_operator` нужным пользователям через админ-панель:
```
/auth/admin/users.php
```

### 3. Автомиграция
При первом запуске автоматически создается:
- **База данных** `press_module`
- **Таблица** `box_catalog` - справочник коробок
- **Таблица** `press_die_cut_blanks` - высеченные заготовки
- **Таблица** `press_glued_boxes` - склеенные коробки
- **Базовые записи** в справочнике коробок

## Структура таблиц

**База данных:** `press_module`

### box_catalog (справочник коробок)
```sql
CREATE TABLE box_catalog (
    id INT AUTO_INCREMENT PRIMARY KEY,
    box_name VARCHAR(255) NOT NULL UNIQUE,
    description TEXT NULL,
    dimensions VARCHAR(100) NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by VARCHAR(255) NULL,
    is_active TINYINT(1) DEFAULT 1
)
```

### press_die_cut_blanks (высеченные заготовки)
```sql
CREATE TABLE press_die_cut_blanks (
    id INT AUTO_INCREMENT PRIMARY KEY,
    shift_date DATE NOT NULL,
    box_name VARCHAR(255) NOT NULL,
    quantity INT NOT NULL,
    operator_name VARCHAR(255) NULL,
    notes TEXT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by VARCHAR(255) NULL
)
```

### press_glued_boxes (склеенные коробки)
```sql
CREATE TABLE press_glued_boxes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    shift_date DATE NOT NULL,
    box_name VARCHAR(255) NOT NULL,
    quantity INT NOT NULL,
    operator_name VARCHAR(255) NULL,
    notes TEXT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by VARCHAR(255) NULL
)
```

## Использование

### Добавление высеченных заготовок
1. Выберите дату смены
2. Заполните форму в левой нижней карточке:
   - Выберите тип коробки из списка
   - Введите количество
3. Нажмите "Добавить заготовки"

### Добавление склеенных коробок
1. Выберите дату смены
2. Заполните форму в правой нижней карточке:
   - Выберите тип коробки из списка
   - Введите количество
3. Нажмите "Добавить коробки"

### Управление справочником коробок (admin/director)
1. Нажмите "⚙️ Управление справочником" в верхней части страницы
2. Добавьте новый тип коробки или активируйте/деактивируйте существующие

## URL доступа
```
http://yoursite.com/press_operator/
```

## Структура файлов
```
press_operator/
├── index.php                      - главная страница модуля (учет производства)
├── manage_boxes.php               - управление справочником коробок (admin/director)
├── add_press_operator_role.sql    - скрипт добавления роли
└── README.md                      - документация
```

## Особенности

- ✅ Отдельная база данных `press_module` (не привязана к участкам)
- ✅ Централизованный справочник коробок
- ✅ Автоматическое создание БД и таблиц при первом запуске
- ✅ Выбор типа коробки из справочника
- ✅ Автосохранение имени пользователя
- ✅ История всех операций
- ✅ Минималистичный интерфейс с карточками 2x2
- ✅ Адаптивный дизайн для мобильных устройств
- ✅ Статистика в реальном времени
- ✅ Управление справочником для admin/director

## Технические детали

- **Backend**: PHP 7.4+
- **Database**: MySQL 5.7+ / MariaDB 10.3+
- **Frontend**: Vanilla JavaScript (ES6+)
- **Auth**: Интеграция с общей системой авторизации
- **UI**: Modern gradient design

## Безопасность

- Проверка авторизации на каждом запросе
- SQL-инъекции предотвращены через prepared statements
- Валидация всех входных данных
- Доступ только для авторизованных пользователей с правильными ролями

## Поддержка

При возникновении проблем проверьте:
1. Выполнен ли SQL скрипт добавления роли
2. Назначена ли роль пользователю
3. Существуют ли таблицы в базах данных
4. Корректны ли настройки подключения к БД

